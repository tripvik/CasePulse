@inject NavigationManager Navigation
@implements IDisposable

@if (IsMobile)
{
    <MudStack Row Justify="Justify.SpaceAround" Style="width:100%">
        <MudIconButton Href="/" 
                       Icon="@Icons.Material.Outlined.Home" 
                       Color="Color.Inherit" 
                       Size="Size.Medium"
                       Style="@GetButtonStyle("/")" />
        <MudIconButton Href="/dashboard"
                       Icon="@Icons.Material.Outlined.Dashboard"
                       Color="Color.Inherit"
                       Size="Size.Medium"
                       Style="@GetButtonStyle("/dashboard")" />
        <MudIconButton Href="/history" 
                       Icon="@Icons.Material.Outlined.Book" 
                       Color="Color.Inherit" 
                       Size="Size.Medium"
                       Style="@GetButtonStyle("/logs")" />
        <MudIconButton Href="/impact" 
                       Icon="@Icons.Material.Outlined.LightMode" 
                       Color="Color.Inherit" 
                       Size="Size.Medium"
                       Style="@GetButtonStyle("/impact")" />
        <MudIconButton Href="/manager-dashboard"
                       Icon="@Icons.Material.Outlined.ManageAccounts"
                       Color="Color.Inherit"
                       Size="Size.Medium"
                       Style="@GetButtonStyle("/impact")" />
    </MudStack>
}
else
{
    <MudNavMenu Color="Color.Primary" Margin="Margin.Normal">
        <MudNavLink Href="/" Icon="@Icons.Material.Outlined.Home" Match="NavLinkMatch.All">Home</MudNavLink>
        <MudNavLink Href="/dashboard" Icon="@Icons.Material.Outlined.Dashboard">Dashboard</MudNavLink>
        <MudNavLink Href="/logs" Icon="@Icons.Material.Outlined.Book">Log Book</MudNavLink>
        <MudNavLink Href="/impact" Icon="@Icons.Material.Outlined.LightMode">Impact</MudNavLink>
        <MudNavLink Href="/manager-dashboard" Icon="@Icons.Material.Outlined.ManageAccounts">Manager Dashboard</MudNavLink>
    </MudNavMenu>
}

@code {
    [Parameter] public bool IsMobile { get; set; } = false;

    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        StateHasChanged();
    }

    private string GetButtonStyle(string href)
    {
        var currentPath = new Uri(Navigation.Uri).AbsolutePath;
        
        // Check if current path matches the href
        bool isActive = string.Equals(currentPath, href, StringComparison.OrdinalIgnoreCase);
        
        return isActive ? "background: var(--mud-palette-primary-hover);" : "";
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}